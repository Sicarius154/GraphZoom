<!DOCTYPE html>
<html lang="en">
<head>
  <!-- These styles are only used by cytoscape for altering the appearance of the graph -->
  <style>
  .nolabel{
    content:"";
  }
  </style>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Graph Zoom Result</title>
  <!-- Bootstrap -->
  <link rel="stylesheet" href="../css/bootstrap.min.css" />

  <!-- Load all of the scripts needed -->
  <script src="jquery.min.js"></script> </script>
  <script src="bootstrap.min.js"></script>
  <script src="cytoscape.js"></script>
  <script src="cytoscape-grid-guide.js"></script>
  <script src="socket.io.js"></script>

  <script>
  //This will be initialized by the calling window with the graph data we need
  var resultsOfOperation = null
  function start(){
    //start the cytoscape object
    cy = cytoscape(
      {
        container: document.getElementById('graph-result-area'),
        style: [
            {
              selector: "node",
              style:{
              "text-valign": "center",
              "text-halign": "center",
              "label": "data(label)"
            }
            },
          {
            selector: "edge",
            style:
            {
              "curve-style": "bezier",
              "label": "data(label)"
            }
          }
        ]
      }
    );
    console.log("Loaded CytoScape Object in the child window");
    console.log("Requesting the operation results from the server...");
    //Connect to the server
    socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.on('connect', function(){
      console.log("Connected to the main server");
    });

    //Set an event handler to receive the JSON data from the server, this will set it to the local variable
    socket.on("received_results_of_operation", function(data){
      resultsOfOperation = data;
    });

    //Request the results
    socket.emit("get_results_of_operation");

    //Will itterate over all of the nodes, then all of the edges returned and add them to the graph area.
    resultsOfOperation.foreach(function(element){
      cy.add(element);
    });

  }
  </script>
</head>
<body style="height:100vh;" onload="start();">
  <div class="container-fluid" style="height:100vh;">
    <div class="row" style="height:100vh;">
      <!-- The graph will be displayed here. once the window has loaded the graph will be set by the main window. -->
      <div id="graph-result-area" class="col-sm-9 col-md-9 col-bg-9 no-float" >

      </div>
    </div>
  </div>
</body>
</html>
